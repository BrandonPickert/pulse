{% extends 'base.html' %}

{% block content %}
<div class="app">
    <header class="header">
        <h1>Pulse</h1>
        <p>Community workout tracker</p>
    </header>

    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-value">{{ stats.totalWorkouts }}</div>
            <div class="stat-label">Total Workouts</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ stats.totalMinutes }}</div>
            <div class="stat-label">Total Minutes</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ stats.thisWeek }}</div>
            <div class="stat-label">This Week</div>
        </div>
    </div>

    <div class="actions">
        <button class="btn-primary" onclick="toggleForm()">+ Log Workout</button>
    </div>

    <form id="workout-form" class="workout-form" style="display: none;" action="{{ url_for('main.form_create_workout') }}" method="POST">
        <input type="text" name="username" placeholder="Your name" required>
        <select name="type" required>
            <option value="">Select workout type</option>
            <option value="Running">Running</option>
            <option value="Cycling">Cycling</option>
            <option value="Swimming">Swimming</option>
            <option value="Weightlifting">Weightlifting</option>
            <option value="Yoga">Yoga</option>
            <option value="Other">Other</option>
        </select>
        <input type="number" name="duration" placeholder="Duration (minutes)" required min="1">
        <textarea name="notes" placeholder="Notes (optional)" rows="3"></textarea>
        <button type="submit" class="btn-primary">Save Workout</button>
    </form>

    <div class="workouts-list">
        <h2>Recent Workouts</h2>
        {% if workouts %}
            {% for workout in workouts %}
            <div class="workout-card">
                <div class="workout-header">
                    <div>
                        <strong>{{ workout.username }}</strong>
                        <span class="workout-type">{{ workout.type }}</span>
                    </div>
                    <form action="{{ url_for('main.form_delete_workout', workout_id=workout.id) }}" method="POST" style="display: inline;">
                        <button type="submit" class="btn-delete">Delete</button>
                    </form>
                </div>
                <div class="workout-details">
                    <span>{{ workout.duration }} minutes</span>
                    <span>{{ workout.createdAt[:10] if workout.createdAt else '' }}</span>
                </div>
                {% if workout.notes %}
                <p class="workout-notes">{{ workout.notes }}</p>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
            <p class="empty-state">No workouts yet. Log your first one!</p>
        {% endif %}
    </div>
</div>

<script>
function toggleForm() {
    const form = document.getElementById('workout-form');
    const btn = document.querySelector('.actions .btn-primary');
    if (form.style.display === 'none') {
        form.style.display = 'block';
        btn.textContent = 'Cancel';
    } else {
        form.style.display = 'none';
        btn.textContent = '+ Log Workout';
    }
}
</script>
{% endblock %}
